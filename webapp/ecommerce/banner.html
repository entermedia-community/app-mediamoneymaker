#set($bannerlist = $context.getRequestParameter("bannerlist"))

<div id="homepage-offers" class="draft1" style="position: relative; width: 700px; height: 322px;">
	<div id="banner-slideshow" class="cycle-slideshow" data-cycle-fx="fade" data-cycle-timeout="8000" data-cycle-speed="1500" data-cycle-sync="true" data-cycle-pager-template="<img src='$apphome/layout/images/banner/white.png' width='18' >">
    	<div class="cycle-pager"></div>
    	#set($first = $bannerlist.size())
    	#set($second = $first + 1)
    	<img id="banner-$first" src="/$applicationid/layout/images/banner/uptown-banner.jpg" class="offers" data-target="_self" data-url="" />
    	<img id="banner-$second" src="/$applicationid/layout/images/banner/rogers-supplier-banner.jpg" class="offers" data-target="_self" data-url="" />
		#if($bannerlist.size() > 0)
			#if($bannerlist.size() >= 2)
				#set($size = $bannerlist.size())
				#set($size = $size - 1)
				#foreach($i in [0..$size])
					#set($first  = $bannerlist.get($i))
					#set($o = $bannersearcher.searchById($first.getId()))
					#set($startdate = $DateStorageUtil.parseFromStorage($i.get("startdate")))
					#set($enddate = $DateStorageUtil.parseFromStorage($i.get("enddate")))
					#set($asset = $mediaarchive.getAsset($first.image))
					#set($orig = $mediaarchive.asLinkToOriginal($asset))
					#set($newwindow = $first.get("newwindow"))
					#if($newwindow == "true")
						#set($target = "_blank")
					#else
						#set($target = "_self")
					#end
					<img id="banner-$i" src="$orig" class="offers" data-target="$target" data-url="$!first.url" />
				#end 
			#else
				#set($first  = $bannerlist.get(0))
				#set($asset = $mediaarchive.getAsset($first.image))
				#set($orig = $mediaarchive.asLinkToOriginal($asset))
				#set($newwindow = $first.get("newwindow"))
				#if($newwindow == "true")
					#set($target = "_blank")
				#else
					#set($target = "_self")
				#end
				<img id="banner-0"  src="$orig" class="offers" data-target="$target" data-url="$!first.url" />
			#end
		#end
	</div>
</div>
<div style="clear: left;">&nbsp;</div>

<script>
$(document).ready(function(){
	$( '#banner-slideshow' ).on( 'cycle-before', function( event, opts ) {
		var current = opts.currSlide;
	    var url = $("#banner-"+current).data("url");
	    var target = $("#banner-"+current).data("target");
	    //console.log("UNBIND before: "+current+", "+url+", "+target);
	    //$("#banner-"+current).unbind("click");
	    $("#banner-"+current).off( "click", "**" );//remove ALL click event handlers
	});
	$( '#banner-slideshow' ).on( 'cycle-after', function( event, opts ) {
		var current = opts.currSlide;
		var url = $("#banner-"+current).data("url");
	    var target = $("#banner-"+current).data("target");
	    if(url.length > 0){
	    	//console.log("BIND after: "+current+", "+url+", "+target);
	    	$( "#banner-"+current ).bind( "click", function() {
	    		window.open(url,target,"","");
	    	});
	    }
	});
});
</script>
<style>
.cycle-pager { 
    text-align: center; 
    width: 100%; 
    z-index: 500; 
    position: absolute; 
    bottom: -30px;
    overflow: hidden;
}
.cycle-pager span { 
    font-family: arial; 
    font-size: 50px; 
    width: 16px; 
    height: 16px; 
    display: inline-block; 
    color: #fff;
    cursor: pointer; 
}
.cycle-pager-active {
	background-image:url("$apphome/layout/images/banner/black.png");
	background-size:18px 18px;
	background-repeat:no-repeat;
}
.cycle-pager > * { 
	cursor: pointer;
}
</style>
