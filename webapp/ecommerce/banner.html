#set($bannerlist = $context.getRequestParameter("bannerlist"))

### offset is the number of images that are hardcoded in the slideshow
#set($imgoffset = 2)
<div id="homepage-offers" class="draft1" style="position: relative; width: 700px; height: 322px;">
	<div id="banner-slideshow" class="cycle-slideshow" data-cycle-fx="fade" data-cycle-timeout="8000" data-cycle-speed="1500" data-cycle-sync="true" data-cycle-pager-template="<img src='$apphome/layout/images/banner/white.png' width='18' >">
    	<div class="cycle-pager"></div>
    	### list hard-coded images here
    	<img id="banner-0" src="/$applicationid/nhl/banner.jpg" class="offers" data-target="_self" data-url="/$applicationid/nhl/" data-name="NHL Banner" />
    	<img id="banner-1" src="/$applicationid/layout/images/banner/rogers-supplier-banner.jpg" class="offers" data-target="_self" data-url="" data-name="Suppliers Banner" />
    	#if($bannerlist.size() > 0)
			#if($bannerlist.size() > 1)
				#set($size = $bannerlist.size())
				#set($size = $size - 1)
				#foreach($i in [0..$size])
					#set($first  = $bannerlist.get($i))
					#set($o = $bannersearcher.searchById($first.getId()))
					#set($startdate = $DateStorageUtil.parseFromStorage($i.get("startdate")))
					#set($enddate = $DateStorageUtil.parseFromStorage($i.get("enddate")))
					#set($asset = $mediaarchive.getAsset($first.image))
					#set($orig = $mediaarchive.asLinkToOriginal($asset))
					#set($newwindow = $first.get("newwindow"))
					#if($newwindow == "true")
						#set($target = "_blank")
					#else
						#set($target = "_self")
					#end
					#set($index = $i + $imgoffset)
					<img id="banner-$index" src="$orig" class="offers" data-target="$target" data-url="$!first.url" data-name="$i in list"/>
				#end
			#else
				#set($first  = $bannerlist.get(0))
				#set($asset = $mediaarchive.getAsset($first.image))
				#set($orig = $mediaarchive.asLinkToOriginal($asset))
				#set($newwindow = $first.get("newwindow"))
				#if($newwindow == "true")
					#set($target = "_blank")
				#else
					#set($target = "_self")
				#end
				<img id="banner-$imgoffset"  src="$orig" class="offers" data-target="$target" data-url="$!first.url" />
			#end
		#end
	</div>
</div>
<div style="clear: left;">&nbsp;</div>

<script>
$( '#banner-slideshow' ).on( 'cycle-initialized', function( event, opts ) {
	var current = 0;
    var url = $("#banner-"+current).data("url");
    var target = $("#banner-"+current).data("target");
    var name = $("#banner-"+current).data("name");
    //console.log("INIT: "+current+", "+name+", url: "+url);
    if(url!=undefined && url.length > 0){
    	$( "#banner-"+current ).bind( "click", function() {
    		window.open(url,target,"","");
    	});
    }
});
$(document).ready(function(){
	if (jQuery().cycle) {
		$( '#banner-slideshow' ).on( 'cycle-before', function( event, opts ) {
			var current = opts.currSlide;
		    var url = $("#banner-"+current).data("url");
		    var target = $("#banner-"+current).data("target");
		    var name = $("#banner-"+current).data("name");
		    //console.log("CYCLE-BEFORE: "+current+", "+name+", url: "+url);
		    $("#banner-"+current).off( "click", "**" );//remove ALL click event handlers
		    //now enable the next in the list
		    current = parseInt(opts.currSlide);
			if ($("#banner-"+(current+1)).length == 0){
				current = 0;//reached end of the list
			} else {
				current = current + 1;
			}
			url = $("#banner-"+current).data("url");
		    target = $("#banner-"+current).data("target");
		    name = $("#banner-"+current).data("name");
		    if(url!=undefined && url.length > 0){
		    	$( "#banner-"+current ).bind( "click", function() {
		    		window.open(url,target,"","");
		    	});
		    }
		});
		$( '#banner-slideshow' ).on( 'cycle-after', function( event, opts ) {
			var current = parseInt(opts.currSlide);
			var url = $("#banner-"+current).data("url");
		    var target = $("#banner-"+current).data("target");
		    var name = $("#banner-"+current).data("name");
		    //console.log("CYCLE-AFTER: "+current+", "+name+", url: "+url);
		});
		$( '#banner-slideshow' ).on( 'cycle-pager-activated', function( event, opts ) {
			var current = parseInt(opts.currSlide);
			var url = $("#banner-"+current).data("url");
		    var target = $("#banner-"+current).data("target");
		    var name = $("#banner-"+current).data("name");
		    //console.log("PAGER-ACTIVATED: "+current+", "+name+", url: "+url);
		    if(url!=undefined && url.length > 0){
		    	$( "#banner-"+current ).bind( "click", function() {
		    		window.open(url,target,"","");
		    	});
		    }
		});
	} else {
		var first = false;
		$(".offers").each(function(){
			if (first == false){
				first = true;
			} else {
				$(this).css("display","none");
			}
		});       
	}
});
</script>
<style>
.cycle-pager { 
    text-align: center; 
    width: 100%; 
    z-index: 500; 
    position: absolute; 
    bottom: -30px;
    overflow: hidden;
}
.cycle-pager span { 
    font-family: arial; 
    font-size: 50px; 
    width: 16px; 
    height: 16px; 
    display: inline-block; 
    color: #fff;
    cursor: pointer; 
}
.cycle-pager-active {
	background-image:url("$apphome/layout/images/banner/black.png");
	background-size:18px 18px;
	background-repeat:no-repeat;
}
.cycle-pager > * { 
	cursor: pointer;
}
</style>
