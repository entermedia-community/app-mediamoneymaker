#set($orderset = $context.getSessionValue("orderset"))
#set($productsearcher = $searcherManager.getSearcher($catalogid, "product"))

<div class="ui-widget uipanel">
	<div class="ui-widget-header">Rogers Corporate Orders</div>
	<div class="ui-widget-content">
	<h2>Your orders have been imported.</h2>
	#set($orders = $orderset.getOrders())
	<table >
		<tr>
			<th style="padding: 10px;">Edit</th>
			<th style="padding: 10px;">Order ID</th>
			<th style="padding: 10px;">Missing Products</th>
			<th style="padding: 10px;">Inventory Problems</th>
			<th style="padding: 10px;">Status</th>
		</tr>
		<tr>
	#foreach($order in $orders)
			<td style="padding: 10px; text-align: center;">
				<a href="$home$apphome/rogers/orders/orderset/showorder.html?id=$order.getId()"><img src="$home$apphome/theme/images/edit-icon.png"/></a>
			</td>
			<td style="padding: 10px;">$order.getId()</td>
			<td style="padding: 10px;">
			#if($orderset.doesOrderHaveBadProducts($order))
				#set($badproducts = $orderset.getBadProductsPerOrder($order))
				#foreach($product in $badproducts)
					<p>$product</p>
				#end
			#else
				<p>None</p>
			#end
			</td>
			<td style="padding: 10px;">
			#if($orderset.doesOrderHaveOutOfStockProducts($order))
				#set($badproducts = $orderset.getOutOfStockPerOrder($order))
				#foreach($productid in $badproducts)
				  	#set($product = $productsearcher.searchById($productid))
					<p>$product.get("rogerssku")</p>
				#end
			#else
				<p>None</p>
			#end
			</td>
			<td style="padding: 10px; text-align: center;">
			#if($orderset.doesOrderHaveBadProducts($order) || $orderset.doesOrderHaveOutOfStockProducts($order))
				<img src="$home$apphome/theme/images/x-button.png"/>
			#else
				<img src="$home$apphome/theme/images/y-button.png"/>
			#end
			</td>
		</tr>
	#end
	</table>
	#set($baditems = $orderset.getAllBadProducts())
	#if($baditems.size()>0)
		<h2>Bad Products in Orders</h2>
		<p>The following products were not found and have NOT been added to your orders. Would you like to remove these items from your orders?</p>
		#foreach($productid in $baditems)
			<p>ProductID: $productid</p>	
		#end
			<p>
			<form action="$home$apphome/rogers/orders/orderset/removeitems.html">
				<input type="hidden" name="action" value="remove">
				#foreach($productid in $baditems)
				<input type="hidden" name="product" value="${productid}">
				#end
				<input type="submit" name="submit" class="btn" value="Remove all $baditems.size() item(s) from the orders.">
			</form>
		</p>
	#end 
	#set($outofstockitems = $orderset.getOutOfStockOrders())
	#if($outofstockitems.size()>0)
		<p>&nbsp;</p>
		<h2>Bad Stock Orders</h2>
		<p>The following orders have problems with their quantities in stock.</p>
		<p>
		<table >
			<tr>
				<th style="padding: 10px;">Order ID</th>
				<th style="padding: 10px;">Products</th>
				<th style="padding: 10px;">Quantity<br>Ordered</th>
				<th style="padding: 10px;">Quantity<br>In Stock</th>
			</tr>
			#foreach($orderid in $outofstockitems)
			<tr>
				<td>$orderid</td>
				<td>
				#set($order = $orderset.getOrder($orderid))
				#set($badstockproducts = $orderset.getOutOfStockPerOrder($order))
				<ul>
				#foreach($productid in $badstockproducts)
					#set($product = $productsearcher.searchById($productid))
					<li>$product.get("rogerssku")</li>
				#end
				</ul>
				</td>
				<td>
				<ul>
				#foreach($productid in $badstockproducts)
					#set($product = $productsearcher.searchById($productid)) 
					#set($qty = $orderset.getQuantityForProductInOrder($order, $product))
					<li>$qty</li>
				#end
				</ul>
				</td>
				<td>
				<ul>
				#foreach($productid in $badstockproducts)
					#set($product = $productsearcher.searchById($productid))
					#set($invitem = $product.getInventoryItem(0))
					<li>$invitem.getQuantityInStock()</li>
				#end
				</ul>
				</td>
			</tr>
			#end
		</table>
		</p>
		<p>Would you like to remove all of the products from these orders that currently have quantity stock problems?</p>
		<form action="$home$apphome/rogers/orders/orderset/removestockitems.html">
			<input type="hidden" name="action" value="remove">
			#foreach($orderid in $outofstockitems)
			<input type="hidden" name="orders" value="${orderid}">
			#end
			<input type="submit" name="submit" class="btn" value="Remove all products from $outofstockitems.size() order(s) which have stock problems.">
		</form>
		
	#end
	#if(($baditems.size() == 0) && ($outofstockitems.size() == 0))
		<h2>Congratulations!</h2>
		<p>There are no errors in these ${orders.size()} order(s).</p>
		<p>Click continue to view an overview of your ${orders.size()} order(s).</p>
		<form action="$home$apphome/rogers/orders/orderset/continueorder.html">
			<input type="submit" name="submit" value="Continue">
		</form>
	#end
	</div>
</div>

