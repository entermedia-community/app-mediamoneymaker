#set($orderlist = $context.getPageValue("orderlist"))
#set($batchsearcher = $searcherManager.getSearcher($catalogid, "as400"))
#set($batch = $batchsearcher.searchById($id))
#set($batchid = $batch.get("batchid"))
#set($batchname = $batch.get("name"))
#set($ordersearcher = $searcherManager.getSearcher($catalogid, "storeOrder"))
#set($storesearcher = $searcherManager.getSearcher($catalogid, "rogersstore"))
<div class="ui-widget uipanel">
	<div class="ui-widget-header">Rogers Corporate Orders</div>
	<div class="ui-widget-content">
	<h2>The following orders have been processed:</h2>
	<p>
		<table >
			<tr>
				<th style="padding: 3px;">View</th>
				<th style="padding: 3px;">Order ID</th>
				<th style="padding: 3px;">Store</th>
				<th style="padding: 3px;">Total</th>
			</tr>
		#foreach($orderid in $orderlist)
			#set($order = $ordersearcher.searchById($orderid))
			#set($customerid = $order.getCustomer().getId())
			#set($id = $customerid.split("-"))
			#set($storeid = $id.get(1))
			#set($rogersstore = $storesearcher.searchById($storeid))
			<tr>
				<td style="padding: 3px;">
					<a href="$home$apphome/views/myaccount/storeorders/view/index.html?id=${orderid}" target="_blank"><img 
					src="$home$apphome/theme/images/y-button.png"/></a>
				</td>
				<td style="padding: 3px; margin-top: 3px;">$orderid</td>
				<td style="padding: 3px; margin-top: 3px;">$rogersstore.get("name")</td>
				<td style="padding: 3px; margin-top: 3px;">$order.getTotalPrice()</td>
			</tr>
		#end
		</table>
		
		#set($batchid = "${as400record.batchid}")
		<h3>Step 1: Export BUD Files</h3>
		<p>
			<a href="$home$apphome/views/modules/as400/BUDDTL.txt?batchid=${batchid}" class="btn">Export orders to BUDDTL</a><br/> 
			<a href="$home$apphome/views/modules/as400/BUDHDR.txt?batchid=${batchid}" class="btn">Export orders to BUDHDR</a><br/>
			<a href="$home$apphome/views/modules/as400/BUDFILES.zip?batchid=${batchid}" class="btn">Download BUDDTL and BUDHDR files</a>
		</p>
		
		<h3>Step 2: Update PO</h3>
		<form class="ajaxform"  targetdiv="poresponse" action="$home$apphome/rogers/orders/orderset/updatepo.html" method="post">
			<input name="save" type="hidden" value="true" />
			<input name="id" type="hidden" value="${as400record.id}" />
			<input name="searchtype" type="hidden" value="as400" />
			<input type="hidden" name="batchid" value="${batchid}" />
			<input type="hidden" name="field" value="as400po" />
			<input type="hidden" name="oemaxlevel" value="1" />
			<input type="text" name="as400po.value" value="" required/>
			<input name="origURL"  type="hidden" value="$!origURL" />
			<input type="submit" value="Update">
		</form>
		<span id="poresponse"></span>
		
		<h3>Step 3: Process Other Orders</h3>
		<p><a href="$home$apphome/rogers/orders/rogersorder.html" class="btn">Upload a New Order</a> <a href="$home$apphome/views/myaccount/storeorders/index.html" class="btn">View all of my Orders</a></p>
	</div>
</div>