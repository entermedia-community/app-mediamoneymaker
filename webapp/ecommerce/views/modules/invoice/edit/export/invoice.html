#set( $moduleid = $context.findValue("module") )
#set($module = $searcherManager.getData($catalogid, "module", $moduleid))
#set($invoicesearcher = $searcherManager.getSearcher($catalogid, "invoice"))
#set($invoiceitemsearcher = $searcherManager.getSearcher($catalogid, "invoiceitem"))
#set($distributorsearcher = $searcherManager.getSearcher($catalogid, "distributor"))
#set($productsearcher = $searcherManager.getSearcher($catalogid, "product"))
#set($ordersearcher = $searcherManager.getSearcher($catalogid, "storeOrder"))
#set($invoiceNumber = $invoice.get("invoicenumber"))
#set($invoicedate = $invoice.get("date"))
#set($fedtaxid = $invoice.get("fedtaxid"))
#set($distributor = $distributorsearcher.searchById($invoice.get("distributor")))
#set($subtotal = "0")
#set($orderNumber = $invoice.get("ponumber"))
#set($order = $ordersearcher.searchById($orderNumber))
<table width="90%" border="0" align="center">
	<tr>
		<td align="center">
			<span style="font-size:20px"><strong>$distributor.get("fullname") INVOICE</strong></span>
		</td>
	</tr>
	<tr>
		<td align="center">
			<span style="font-size:20px">&nbsp;</span>
		</td>
	</tr>
	<tr>
		<td align="center">
			<table border="0" width="100%">
				<tr>
					<td align="left" valign="top" nowrap><strong>DATE :</strong></td>
					<td valign="top" nowrap width="100%">$invoicedate</td>
					<td align="right" nowrap><strong>Invoice #$invoiceNumber</strong></td>
				</tr>
				<tr>
					<td valign="top"><strong>FROM:</strong></td>
					<td><span style="font-size:20px"><strong>$distributor.get("fullname")</strong></span><br>
					<span style="font-size:16px">$distributor.get("address1")<br>
					#if ($distributor.get("address2") && $distributor.get("address2")!="")
						$!distributor.get("address2")<br>
					#end
					$distributor.get("city"), $distributor.get("province")<br>
					$distributor.get("postalcode")<br>
					Phone: $!distributor.get("phone1")<br>
					#if ($distributor.get("fax") && $distributor.get("fax")!="")
						Fax: $!distributor.get("fax")<br>
					#end
					#if ($distributor.get("email") && $distributor.get("email")!="")
						Email: $!distributor.get("email")<br>
					#end
					</span></td>
					<td>&nbsp;</td>
				</tr>
				<tr>
					<td valign="top"><strong>SOLD TO:</strong></td>
					<td><span style="font-size:20px"><strong>Area Communications</strong></span><br>
					<span style="font-size:16px">1 Hurontario St.<BR>
					Suite 220<br>
					Mississauga, ON<BR>
					L5G 0A3<br>
					Phone: 905-271-2732<br>
					Fax: 905-271-7724</span>
					</td>
					<td>&nbsp;</td>
				</tr>
				<tr>
					<td colspan="3">
						<table border="1" width="100%" style="margin-top: 20px;">
							<tr style="text-align: center; margin-top: 10px;">
								<td valign="top" colspan="2"><strong>REFERENCE</strong></td>
							</tr>
							<tr style="text-align: center;">
								<td><span style="font-size:18px"><strong>ORDER/PO NUMBER</strong></span></td>
								<td><span style="font-size:18px"><strong>SHIP TO:</strong></span></td>
							</tr>
							<tr>
								<td valign="middle" style="text-align: center;">
									<span style="font-size:14px">$invoice.get("ponumber")</span>
								</td>
								<td valign="top">
									#set($address = $order.getShippingAddress())
									<span style="font-size:14px"><strong>$address.getName()</strong><br>
									$address.get("address1")<br>
									#if ($address.get("address2") && $address.get("address2")!="")
										$!address.get("address2")<br>
									#end
									$address.get("city"), $distributor.get("province")<br>
									$address.get("zip")<br>
									</span>
								</td>
							</tr>
						</table>
					</td>
			</table>
		</td>
	</tr>
	<tr>
		<td align="center">
			<span style="font-size:20px">&nbsp;</span>
		</td>
	</tr>
	<tr>
		<td>
			<table border="1" width="100%">
				<tr>
					<td align="center"><strong>Quantity</strong></td>
					<td align="center"><strong>Product ID</strong></td>
					<td align="center"><strong>Description</strong></td>
					<td align="center"><strong>Unit Price</strong></td>
					<td align="center"><strong>Line Total</strong></td>
				</tr>
				#foreach($inv in $invoiceitems)
				<tr>
					#set($qty=$inv.get("quantity"))
					<td align="center">$qty</td>
					#set($product = $productsearcher.searchById($inv.get("product")))
					<td align="center">$product.getId()</td>
					<td align="left">$product.get("name")</td>
					#set($price=$inv.get("price"))
					<td align="right">$price</td>
					<td align="right">$inv.linetotal</td>
				</tr>
				#end
				<tr>
					<td colspan="4" align="right"><strong>Sub Total</strong></td>
					<td align="right">$invoice.subtotal</td>
				</tr>
				<tr>
					<td colspan="4" align="right">Shipping</td>
					<td align="right">$formatutil.formatString($invoice.get("shipping"))</td>
				</tr>
				<tr>
					<td colspan="4" align="right">HST/GST Tax ( $fedtaxid )</td>
					<td align="right">$formatutil.formatString($fedtaxes)</td>
				</tr>
				<tr>
					<td colspan="4" align="right">Provincial Tax</td>
					<td align="right">$formatutil.formatString($provtaxes)</td>
				</tr>
				<tr>
					<td colspan="4" align="right"><strong>Total</strong></td>
					<td align="right">$formatutil.formatString($total)</td>
				</tr>
			</table>
		</td>
	</tr>
</table>