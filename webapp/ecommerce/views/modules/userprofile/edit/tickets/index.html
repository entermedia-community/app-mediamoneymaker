#set($hits = $mediaarchive.getSearcher("ticket").fieldSearch("owner", $userprofile.id))

$context.putPageValue("hits", "false")
$context.putPageValue("searcher", $mediaarchive.getSearcher("ticket"))
$context.putPageValue("resultshome", "$apphome/views")

$pages.include("")
<div class="ui-widget uipanel">
	<div class="ui-widget-header">Ticket History</div>
	<div class="ui-widget-content ">

	#set($ticketsearcher = $mediaarchive.getSearcher("ticket"))
	#set($tickethistorysearcher = $mediaarchive.getSearcher("tickethistory"))
	#set($productsearcher = $mediaarchive.getSearcher("product"))
	#set($userprofilesearcher = $mediaarchive.getSearcher("userprofile"))
	#set($tickettypesearcher = $mediaarchive.getSearcher("tickettype"))
	#set($ticketstatussearcher = $mediaarchive.getSearcher("ticketstatus"))
	
	#set($details = $tickethistorysearcher.getAllHits())
	#if($details.size() > 0)
	<table border="1" cellpadding="5">
		<thead>
			<td width="10%">Date</td>
			<td width="10%">Owner</td>
			<td width="10%">Product</td>
			<td width="10%">Ticket Type</td>
			<td width="10%">Ticket Status</td>
			<td width="50%">Notes</td>
		</thead>
		<tbody>
		    #foreach( $detail in $details)
		    	#set($ticket = $ticketsearcher.searchById($detail.getId()))
		    	#if($ticket)
		    		#set($user = $userprofilesearcher.searchById($ticket.get("owner")))
		    		#if($user == $ownerid)
			    		<tr><td colspan="6">$user</td></tr>
			    		#set($product = $productsearcher.searchById($entry.get("product")).getName())
			    		#set($tickettype = $tickettypesearcher.searchById($entry.get("tickettype")).getName())
			    		#set($ticketstatus = $entry.get("ticketstatus"))
		    			#if($ticketstatus)
		    				#set($ticketstatus = $ticketstatussearcher.searchById($entry.get("ticketstatus")).getName())
		    			#else
		    				#set($ticketstatus = "Has not been set")
		    			#end
						<tr>
			    			<td nowrap>
				    			<p>$!entry.get("date")</p>
				    		</td>
			    			<td nowrap>
				    			<p>$owner</p>
				    		</td>
			    			<td>
				    			<p>$product</p>
				    		</td>
			    			<td>
				    			<p>$tickettype</p>
				    		</td>
			    			<td>
				    			<p>$ticketstatus</p>
				    		</td>
			    			<td>
				    			<p>$!entry.get("notes")</p>
				    		</td>
						</tr>
					#end
				#end
			#end
		</tbody>
	</table>
	#end 
	</div>
</div>
