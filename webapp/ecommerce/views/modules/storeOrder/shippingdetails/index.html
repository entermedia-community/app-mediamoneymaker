#set ( $customer = $order.customer ) 
#set ( $orderid = $order.getId() )
#set ( $shippingAddress = $order.getShippingAddress() ) 
#set ( $billingAddress = $order.getBillingAddress() ) 
#set ( $searcherManager = $store.getSearcherManager() ) 
#set ( $orderNumber = $order.orderNumber )
#set ( $shipments = $order.getShipments() ) 
#set ( $isFullyShipped = $order.isFullyShipped() )
#set ( $sSize = $shipments.size() )

<div class="ui-widget-content">
	<h2>Shipping History</h2>
	<h3>Order ID: $orderid</h3>
	#if ( $sSize > 0)
		<h3>Order Status: 
			#if ($isFullyShipped == "false")
				Partially Shipped
			#else
				Shipped
			#end</h3>
		<h3>Shipment Details per Product.</h3>
	#else
		<h2>No shipments for this order</h2>
	#end
	#if ( $sSize > 0)
		<table cellspacing="2" class="oestandard-table" cellpadding="10">
			<tr class="results-list-head">
				<th align="left" class="results-list-head">Product SKU</th>
				<th align="left" class="results-list-head" style="padding-left: 10px;">Product ID</th>
				<th align="center" width="100" class="results-list-head" style="padding-left: 10px;">Quantity Ordered</th>
				<th align="center" class="results-list-head" style="padding-left: 10px;">Waybill Number</th>
				<th align="center" class="results-list-head" style="padding-left: 10px;">Quantity<br/>Shipped</th>
			</tr>
			#set($itemCounter = 0)
			#foreach ( $item in $order.getItems() )
				#set( $productid = $item.getProduct().getId()) 
				#set( $itemCounter = $itemCounter + 1 )
				#if ( ($itemCounter % 2) == 0 )
					<tr class="results-list-a">
				#else
					<tr class="results-list-b">
				#end
				#set( $product = $store.getProductSearcher().searchById($productid) )
				<td class="results-list-center">$product.get("manufacturersku")</td>
				#set( $path="$apphome/products/${store.getProductPathFinder().idToPath($productid)}.html" )
				<td><a href="$home$path?oemaxlevel=2" class="thickbox" 
						data-fancybox-type="ajax"><img 
						src="$home$apphome/theme/images/details_open.png"/></a>$product.getName()</td>
				<td class="results-list-center">$item.quantity</td>
				<td class="results-list-left">&nbsp;</td>
				<td class="results-list">&nbsp;</td>
				#foreach ( $shipment in $shipments )
					#if ( $shipment.containsEntryForSku($product.get("manufacturersku")) )
						#set($entry = $shipment.getEntryForSku($product.get("manufacturersku")))
						</tr>
						#if ( ($itemCounter % 2) == 0 )
							<tr class="results-list-a">
						#else
							<tr class="results-list-b">
						#end
						<td colspan="3" class="results-list-left">&nbsp;</td>
						<td class="results-list-left">
						#set($waybill = $shipment.get("waybill"))
						#if (!$waybill.equals("") && $waybill.length()>0)
							#set($wb = $context.getRequestParameter("waybill"))
							#if($wb == $waybill)
								<span style="color:blue;font-weight:bold;">$waybill</span>
							#else
								$waybill
							#end
						#else
							N/A
						#end
						</td>
						<td class="results-list-center">$entry.getQuantity()</td>
						</tr>
						#set($waybill = "")
					#end
				#end
			#end
			</tr>
		</table>
		
		#foreach ( $shipmentEntry in $shipments )
			#set( $shipCounter = $shipCounter + 1 )
		#end
		
		<h3 style="margin-top: 10px;">Shipment Details per Waybill.</h3>
		<table cellspacing="5" class="standard-table" cellpadding="3" border="0">
			<tr class="results-list-head">
				<th align="center" class="results-list-head">Waybill Number</th>
				<th align="left" class="results-list-head" style="padding-left: 10px;">Product SKU</th>
				<th align="left" class="results-list-head" style="padding-left: 10px;">Product Name</th>
				<th align="center" class="results-list-head" style="padding-left: 10px;">Quantity<br/>Shipped</th>
			</tr>
			
			#set( $types = $searcherManager.getList($catalogid ,"itemstatus") )
			#set( $shipCounter = 0)
			#foreach ( $shipment in $shipments )
				#set( $shipCounter = $shipCounter + 1 )
				#set( $waybill = $shipment.get("waybill") )
				#set( $courier = $shipment.get("courier") )
				#set( $shipdate = $shipment.get("shipdate") )
				#if ( ($shipCounter % 2) == 0 )
					<tr class="results-list-a">
				#else
					<tr class="results-list-b">
				#end
				#if (!$waybill.equals("") && $waybill.length()>0)
					<td class="results-list">
						<a href="$home$apphome/views/modules/storeOrder/shippingdetails/waybilldetails.html?waybill=$waybill&id=$orderid&oemaxlevel=1"
						class="thickbox" data-fancybox-type="ajax">
							<img src="$home$apphome/theme/images/details_open.png"/>
						</a>
						#set($wb = $context.getRequestParameter("waybill"))
						#if($wb == $waybill)
							<span style="color:blue;font-weight:bold;">$waybill</span>
						#else
							$waybill
						#end
					</td>
				#else
					<td class="results-list">N/A</td>
				#end
					<td colspan="3" class="results-list-left">&nbsp;</td>
					</tr>
				#foreach ( $item in $order.getItems() ) 
					#set( $productid = $item.getProduct().getId()) 
					#set( $product = $item.getProduct())
					#set( $productsku = $product.get("manufacturersku"))
					#if ( $shipment.containsEntryForSku($productsku) )
						#set( $entry = $shipment.getEntryForSku($productsku) )
						#set( $product = $store.getProductSearcher().searchById($productid) )
						#if ( ($shipCounter % 2) == 0 )
							<tr class="results-list-a">
						#else
							<tr class="results-list-b">
						#end
						<td class="results-list-left">&nbsp;</td>
						<td class="results-list-left">$productsku</td>
						<td class="results-list-left">$product.getName()</td>
						<td class="results-list-center">$entry.getQuantity()</td>
						</tr>
					#end
				#end
				#set($waybill = "")
				#set($productid = "")
				#set($productsku = "")
			#end
		</table>
	#end
</div>
<!-- 
#foreach ($detail in $store.fieldArchive.getDataProperties("product","orderdetails",$user))
	<th align="center">b - $!detail.text</th> 
#end
#foreach ( $detail in $store.fieldArchive.getDataProperties("product","orderdetails",$user)	)
	<td>$!item.getProduct().get($detail.id)</td>
#end
 -->
